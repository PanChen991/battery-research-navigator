<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½é€Ÿç”µåŠ¨è½¦ç”µæ± å¸‚åœºæ´å¯Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A tabbed single-page application with three main sections: Customer Needs, Competitor Analysis, and Regulatory Standards. This structure directly maps to the user's core research tasks, allowing for focused data exploration. Each section features interactive filters and search bars to drill down into the data, which is presented in digestible cards and tables rather than a single overwhelming table. This enhances usability by progressively disclosing information and allowing users to compare and analyze specific data points efficiently. -->
    <!-- Visualization & Content Choices: Customer Needs: Goal is to explore manufacturer requirements. Uses a filterable grid of expandable cards to show details on demand. A dynamic donut chart visualizes LSEV type distribution. Competitor Analysis: Goal is to compare battery suppliers. Uses a similar filterable card grid and a stacked bar chart to show battery chemistry market share. Regulatory Standards: Goal is to provide a reference. Uses a filterable, sortable table, which is optimal for this structured textual data. All charts use Chart.js on Canvas. This approach avoids static data dumps and encourages interactive exploration. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;
        }
        .tab-button.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
        }
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            display: none;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="app" class="container mx-auto p-4 md:p-6">
        
        <!-- è¿”å›æŒ‰é’® -->
        <div class="mb-4">
            <button onclick="window.close(); if(window.opener){window.opener.focus();} else {window.location.href='/'}" 
                    class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-md">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                è¿”å›ä¸»é¡µ
            </button>
        </div>
        <header class="bg-white rounded-xl shadow-sm p-4 mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-900">ä½é€Ÿç”µåŠ¨è½¦ç”µæ± å¸‚åœºæ´å¯Ÿ</h1>
            <p class="text-slate-500 mt-1">äº¤äº’å¼å¸‚åœºè°ƒç ”æŠ¥å‘Š</p>
        </header>

        <nav class="bg-white rounded-xl shadow-sm p-2 mb-6 sticky top-4 z-30">
            <div id="tabs" class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                <button data-tab="customers" class="tab-button text-left sm:text-center text-slate-600 p-3 border-b-4 border-transparent transition-colors duration-300 ease-in-out hover:bg-slate-100 rounded-lg">
                    <span class="text-lg">ğŸ‘¤</span> å®¢æˆ·éœ€æ±‚æ´å¯Ÿ
                </button>
                <button data-tab="competitors" class="tab-button text-left sm:text-center text-slate-600 p-3 border-b-4 border-transparent transition-colors duration-300 ease-in-out hover:bg-slate-100 rounded-lg">
                    <span class="text-lg">ğŸ“ˆ</span> ç«äº‰æ ¼å±€åˆ†æ
                </button>
                <button data-tab="regulations" class="tab-button text-left sm:text-center text-slate-600 p-3 border-b-4 border-transparent transition-colors duration-300 ease-in-out hover:bg-slate-100 rounded-lg">
                    <span class="text-lg">ğŸ“œ</span> å…¨çƒæ³•è§„æ ‡å‡†
                </button>
            </div>
        </nav>
        
        <main>
            <!-- å®¢æˆ·éœ€æ±‚æ´å¯Ÿ -->
            <section id="customers" class="tab-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-xl font-bold text-slate-900 mb-1">å®¢æˆ·éœ€æ±‚åˆ†æ</h2>
                    <p class="text-slate-500 mb-4">æ·±å…¥äº†è§£ä¸åŒåŒºåŸŸå’Œè½¦å‹å®¢æˆ·å¯¹ç”µæ± çš„å…·ä½“éœ€æ±‚ã€ç—›ç‚¹åŠæœŸæœ›ã€‚ä½¿ç”¨ä¸‹æ–¹çš„ç­›é€‰å™¨æ¥æ¢ç´¢æ•°æ®ã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input id="customer-search" type="text" placeholder="æœç´¢å®¢æˆ·åç§°..." class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <select id="customer-region-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="">æ‰€æœ‰åŒºåŸŸ</option>
                        </select>
                        <select id="customer-type-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="">æ‰€æœ‰è½¦å‹</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm overflow-x-auto">
                            <table class="w-full text-left text-sm">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                    <tr>
                                        <th class="p-3">å®¢æˆ·æ¸…å•</th>
                                        <th class="p-3">å®¢æˆ·åŒºåŸŸ</th>
                                        <th class="p-3">ä½é€Ÿè½¦ç±»å‹</th>
                                        <th class="p-3">ç”µæ± åŒ…å…³é”®ä¿¡æ¯</th>
                                        <th class="p-3">ç”µèŠ¯å…³é”®ä¿¡æ¯</th>
                                        <th class="p-3">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="customer-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white p-6 rounded-xl shadow-sm sticky top-24">
                            <h3 class="text-lg font-bold text-slate-900 mb-4">è½¦å‹åˆ†å¸ƒæ¦‚è§ˆ</h3>
                            <div class="chart-container" style="position: relative; height:350px; max-height:400px; width:100%; max-width:400px; margin: auto;">
                                <canvas id="customer-type-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç«äº‰æ ¼å±€åˆ†æ -->
            <section id="competitors" class="tab-content">
                 <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-xl font-bold text-slate-900 mb-1">ç«äº‰æ ¼å±€åˆ†æ</h2>
                    <p class="text-slate-500 mb-4">è°ƒç ”ä¸»æµç”µæ± ä¾›åº”å•†çš„äº§å“ä¿¡æ¯ã€åˆä½œå“ç‰Œã€æŠ€æœ¯è·¯çº¿åŠå¸‚åœºä¼˜åŠ£åŠ¿ã€‚ä½¿ç”¨ç­›é€‰å™¨æŸ¥çœ‹ç‰¹å®šå‹å•†æˆ–æŠ€æœ¯ç±»å‹ã€‚</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input id="competitor-search" type="text" placeholder="æœç´¢å‹å•†åç§°..." class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <select id="competitor-partner-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                             <option value="">æ‰€æœ‰åˆä½œå“ç‰Œ</option>
                        </select>
                        <select id="competitor-battery-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                             <option value="">æ‰€æœ‰ç”µæ± ç±»å‹</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm overflow-x-auto">
                           <table class="w-full text-left text-sm">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                    <tr>
                                        <th class="p-3">å‹å•†ä¿¡æ¯</th>
                                        <th class="p-3">åˆä½œå“ç‰Œ</th>
                                        <th class="p-3">ç”µæ± ç±»å‹</th>
                                        <th class="p-3">å…³é”®è§‚ç‚¹</th>
                                        <th class="p-3">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="competitor-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white p-6 rounded-xl shadow-sm sticky top-24">
                             <h3 class="text-lg font-bold text-slate-900 mb-4">ç”µæ± æŠ€æœ¯è·¯çº¿åˆ†å¸ƒ</h3>
                             <div class="chart-container" style="position: relative; height:350px; max-height:400px; width:100%; max-width:600px; margin: auto;">
                                <canvas id="competitor-tech-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å…¨çƒæ³•è§„æ ‡å‡† -->
            <section id="regulations" class="tab-content">
                <div class="bg-white p-6 rounded-xl shadow-sm mb-6">
                    <h2 class="text-xl font-bold text-slate-900 mb-1">å…¨çƒæ³•è§„æ ‡å‡†</h2>
                    <p class="text-slate-500 mb-4">æ±‡æ€»å…¨çƒä¸»è¦å¸‚åœºçš„ä½é€Ÿè½¦åŠç”µæ± ç›¸å…³æ³•è§„æ ‡å‡†ï¼Œå¸®åŠ©äº§å“åˆè§„ã€‚è¡¨æ ¼å†…å®¹å¯è¿›è¡Œç­›é€‰å’Œæ’åºã€‚</p>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input id="regulation-search" type="text" placeholder="æœç´¢æ³•è§„åç§°..." class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <select id="regulation-region-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="">æ‰€æœ‰åŒºåŸŸ</option>
                        </select>
                        <select id="regulation-type-filter" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="">æ‰€æœ‰è½¦å‹</option>
                        </select>
                    </div>
                </div>
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-sm overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th class="p-3">åŒºåŸŸ</th>
                                <th class="p-3">è½¦å‹</th>
                                <th class="p-3">æ³•è§„æ ‡å‡†åç§°</th>
                                <th class="p-3">é¢å¸ƒæ—¶é—´</th>
                                <th class="p-3">æ³•è§„ç‰¹ç‚¹è¯´æ˜</th>
                                <th class="p-3">æ³•è§„èƒŒæ™¯è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody id="regulation-table-body">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal-backdrop" class="modal-backdrop"></div>
    <div id="modal" class="modal w-11/12 max-w-2xl bg-white rounded-xl shadow-lg p-6">
        <div id="modal-content"></div>
        <button id="modal-close" class="absolute top-4 right-4 text-slate-500 hover:text-slate-800 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- æ•°æ® ---
    const customerData = [
        { id: 1, name: 'é›…è¿ª', region: 'ä¸­å›½', type: 'è½»ä¾¿ç”µåŠ¨æ‘©æ‰˜', pack: { voltage: '48V/60V', capacity: '20-32Ah', size: '300x180x170mm', temp: '-10~45â„ƒ', life: '>800æ¬¡', ip: 'IP67', painPoints: 'å†¬å­£ç»­èˆªè¡°å‡ä¸¥é‡', convenience: 'æ”¯æŒå¿«å……', complaints: 'ç”µæ± é¼“åŒ…ï¼Œå”®åæ›´æ¢éº»çƒ¦' }, cell: { chemistry: 'ç£·é…¸é“é”‚(LFP)', type: 'è½¯åŒ…', voltage: '3.2V', capacity: '20Ah', size: '150x120x10mm', temp: '-20~55â„ƒ', life: '>2000æ¬¡' } },
        { id: 2, name: 'çˆ±ç›', region: 'ä¸­å›½', type: 'ç”µåŠ¨è‡ªè¡Œè½¦', pack: { voltage: '48V', capacity: '12-24Ah', size: '250x150x150mm', temp: '-10~45â„ƒ', life: '>600æ¬¡', ip: 'IP65', painPoints: 'å……ç”µæ—¶é—´é•¿', convenience: 'è½»ä¾¿ï¼Œå¯æå›å®¶å……ç”µ', complaints: 'å®é™…ç»­èˆªä¸å®£ä¼ ä¸ç¬¦' }, cell: { chemistry: 'é“…é…¸/é”°é…¸é”‚', type: 'æ–¹å£³', voltage: '12V/3.7V', capacity: '12Ah', size: '151x98x95mm', temp: '-15~50â„ƒ', life: '>400æ¬¡' } },
        { id: 3, name: 'ä¹å·', region: 'ä¸­å›½', type: 'ç”µåŠ¨æ‘©æ‰˜', pack: { voltage: '72V', capacity: '20-40Ah', size: '350x200x200mm', temp: '-20~50â„ƒ', life: '>1000æ¬¡', ip: 'IP67', painPoints: 'ç”µæ± åŒ…è¿‡é‡', convenience: 'æ™ºèƒ½åŒ–BMSï¼ŒAppå¯çœ‹çŠ¶æ€', complaints: 'ä»·æ ¼æ˜‚è´µ' }, cell: { chemistry: 'ä¸‰å…ƒé”‚(NCM)', type: 'åœ†æŸ±-21700', voltage: '3.6V', capacity: '5Ah', size: 'Î¦21x70mm', temp: '-20~60â„ƒ', life: '>1500æ¬¡' } },
        { id: 4, name: 'å°ç‰›', region: 'æ¬§æ´²', type: 'è½»ä¾¿ç”µåŠ¨æ‘©æ‰˜', pack: { voltage: '60V', capacity: '26-35Ah', size: '280x180x190mm', temp: '-15~45â„ƒ', life: '>1000æ¬¡', ip: 'IP67', painPoints: 'ä½æ¸©å……ç”µæ…¢', convenience: 'åŒç”µè®¾è®¡ï¼Œç»­èˆªé•¿', complaints: 'ç”µæ± é”æ‰£æ˜“æŸå' }, cell: { chemistry: 'ä¸‰å…ƒé”‚(NCM)', type: 'åœ†æŸ±-18650', voltage: '3.6V', capacity: '3.5Ah', size: 'Î¦18x65mm', temp: '-20~60â„ƒ', life: '>1500æ¬¡' } },
        { id: 5, name: 'ç»¿æº', region: 'ä¸­å›½', type: 'ç”µåŠ¨è‡ªè¡Œè½¦', pack: { voltage: '48V', capacity: '20Ah', size: '260x160x160mm', temp: '-10~45â„ƒ', life: '>800æ¬¡', ip: 'IP67', painPoints: 'ç”µæ± ä¸€è‡´æ€§å·®', convenience: 'æ¶²å†·æŠ€æœ¯ï¼Œæ•£çƒ­å¥½', complaints: 'ç»´ä¿®åªèƒ½è¿”å‚ï¼Œå‘¨æœŸé•¿' }, cell: { chemistry: 'ç£·é…¸é“é”‚(LFP)', type: 'æ–¹å£³', voltage: '3.2V', capacity: '20Ah', size: '140x80x25mm', temp: '-20~55â„ƒ', life: '>2000æ¬¡' } },
        { id: 6, name: 'Ola Electric', region: 'ä¸œå—äºš', type: 'ç”µåŠ¨æ‘©æ‰˜', pack: { voltage: '72V', capacity: '50Ah', size: '400x250x200mm', temp: '-10~55â„ƒ', life: '>1200æ¬¡', ip: 'IP67', painPoints: 'çƒ­å¸¦æ°”å€™ä¸‹ç”µæ± è¿‡çƒ­', convenience: 'å¯æ‹†å¸æ›´æ¢', complaints: 'è½¯ä»¶bugå¯¼è‡´ç”µé‡æ˜¾ç¤ºä¸å‡†' }, cell: { chemistry: 'ä¸‰å…ƒé”‚(NCM)', type: 'åœ†æŸ±-21700', voltage: '3.6V', capacity: '5Ah', size: 'Î¦21x70mm', temp: '-20~60â„ƒ', life: '>1500æ¬¡' } },
        { id: 7, name: 'å°é“ƒ', region: 'ä¸­å›½', type: 'ä¸‰è½®è½¦', pack: { voltage: '60V', capacity: '50Ah', size: '450x220x200mm', temp: '-15~50â„ƒ', life: '>600æ¬¡', ip: 'IP54', painPoints: 'è½½é‡åç»­èˆªè¡°å‡å¿«', convenience: 'å®¹é‡å¤§ï¼ŒåŠ¨åŠ›è¶³', complaints: 'é˜²æ°´æ€§èƒ½ä¸è¶³' }, cell: { chemistry: 'é“…é…¸', type: 'æ–¹å£³', voltage: '12V', capacity: '50Ah', size: '229x138x208mm', temp: '-20~55â„ƒ', life: '>400æ¬¡' } },
    ];

    const competitorData = [
        { id: 1, name: 'CATL', partners: ['ä¹å·', 'é›…è¿ª'], type: 'ç”µåŠ¨æ‘©æ‰˜', batteryType: 'é”‚ç”µæ± NCM', pack: { voltage: '72V', capacity: '30Ah', size: '320x180x190mm', temp: '-20~55â„ƒ', life: '>1200æ¬¡', ip: 'IP67' }, opinion: { painPoints: 'æˆæœ¬é«˜', convenience: 'èƒ½é‡å¯†åº¦é«˜ï¼Œæ€§èƒ½å¼º', complaints: 'é«˜ç«¯è½¦å‹ä¸“ç”¨' }, cell: { chemistry: 'ä¸‰å…ƒé”‚(NCM)', type: 'åœ†æŸ±-21700', voltage: '3.6V', capacity: '5.0Ah', size: 'Î¦21x70mm', temp: '-20~60â„ƒ', life: '>1500æ¬¡' } },
        { id: 2, name: 'å¤©èƒ½ç”µæ± ', partners: ['çˆ±ç›', 'ç»¿æº', 'å°é“ƒ'], type: 'ç”µåŠ¨è‡ªè¡Œè½¦', batteryType: 'é“…é…¸ç”µæ± ', pack: { voltage: '48V', capacity: '20Ah', size: '250x160x150mm', temp: '-15~50â„ƒ', life: '>400æ¬¡', ip: 'IP54' }, opinion: { painPoints: 'ç¬¨é‡ï¼Œä¸ç¯ä¿', convenience: 'ä»·æ ¼ä¾¿å®œï¼ŒæŠ€æœ¯æˆç†Ÿ', complaints: 'å¯¿å‘½çŸ­ï¼Œä¸€å¹´ä¸€æ¢' }, cell: { chemistry: 'é“…é…¸', type: 'æ–¹å£³', voltage: '12V', capacity: '20Ah', size: '181x77x167mm', temp: '-20~55â„ƒ', life: '>400æ¬¡' } },
        { id: 3, name: 'æ˜Ÿæ’ç”µæº(é”‚ç”µ)', partners: ['é›…è¿ª', 'æ–°æ—¥', 'å°åˆ€'], type: 'è½»ä¾¿ç”µåŠ¨æ‘©æ‰˜', batteryType: 'é”‚ç”µæ± LFP', pack: { voltage: '48V', capacity: '24Ah', size: '280x150x160mm', temp: '-20~55â„ƒ', life: '>1500æ¬¡', ip: 'IP67' }, opinion: { painPoints: 'ä½æ¸©æ€§èƒ½ç¨å·®', convenience: 'å®‰å…¨æ€§é«˜ï¼Œé•¿å¯¿å‘½', complaints: 'èƒ½é‡å¯†åº¦ä½äºä¸‰å…ƒ' }, cell: { chemistry: 'ç£·é…¸é“é”‚(LFP)', type: 'è½¯åŒ…', voltage: '3.2V', capacity: '24Ah', size: '160x130x12mm', temp: '-20~55â„ƒ', life: '>2500æ¬¡' } },
        { id: 4, name: 'è¶…å¨', partners: ['ç«‹é©¬', 'é‡‘ç®­'], type: 'ç”µåŠ¨è‡ªè¡Œè½¦', batteryType: 'é“…é…¸ç”µæ± ', pack: { voltage: '60V', capacity: '20Ah', size: '300x180x170mm', temp: '-15~50â„ƒ', life: '>400æ¬¡', ip: 'IP54' }, opinion: { painPoints: 'å……ç”µæ…¢', convenience: 'å¸‚åœºä¿æœ‰é‡å¤§ï¼Œæ›´æ¢æ–¹ä¾¿', complaints: 'ç»­èˆªè™šæ ‡' }, cell: { chemistry: 'é“…é…¸', type: 'æ–¹å£³', voltage: '12V', capacity: '20Ah', size: '181x77x167mm', temp: '-20~55â„ƒ', life: '>400æ¬¡' } },
        { id: 5, name: 'äº¿çº¬(é”‚ç”µ)', partners: ['å°ç‰›', 'å“ˆç½—'], type: 'è½»ä¾¿ç”µåŠ¨æ‘©æ‰˜', batteryType: 'é”‚ç”µæ± NCM', pack: { voltage: '48V', capacity: '30Ah', size: '270x170x180mm', temp: '-20~55â„ƒ', life: '>1000æ¬¡', ip: 'IP67' }, opinion: { painPoints: 'ä»·æ ¼è¾ƒé«˜', convenience: 'èƒ½é‡å¯†åº¦é«˜ï¼Œç»­èˆªæ‰å®', complaints: 'å¯¹BMSè¦æ±‚é«˜' }, cell: { chemistry: 'ä¸‰å…ƒé”‚(NCM)', type: 'åœ†æŸ±-18650', voltage: '3.6V', capacity: '3.5Ah', size: 'Î¦18x65mm', temp: '-20~60â„ƒ', life: '>1500æ¬¡' } },
        { id: 6, name: 'BYD', partners: ['é›…è¿ª', 'æ»´æ»´é’æ¡”'], type: 'ç”µåŠ¨è‡ªè¡Œè½¦', batteryType: 'é”‚ç”µæ± LFP', pack: { voltage: '48V', capacity: '20Ah', size: '260x150x150mm', temp: '-20~60â„ƒ', life: '>2000æ¬¡', ip: 'IP67' }, opinion: { painPoints: 'ä½æ¸©æ‰ç”µ', convenience: 'åˆ€ç‰‡æŠ€æœ¯ï¼Œæè‡´å®‰å…¨', complaints: 'é‡é‡åé‡' }, cell: { chemistry: 'ç£·é…¸é“é”‚(LFP)', type: 'æ–¹å£³(åˆ€ç‰‡)', voltage: '3.2V', capacity: '20Ah', size: '200x130x8mm', temp: '-20~60â„ƒ', life: '>3000æ¬¡' } },
    ];

    const regulationData = [
        { region: 'ä¸­å›½', type: 'ç”µåŠ¨è‡ªè¡Œè½¦', name: 'GB 17761-2018ã€Šç”µåŠ¨è‡ªè¡Œè½¦å®‰å…¨æŠ€æœ¯è§„èŒƒã€‹', date: '2019-04-15', features: 'æ•´è½¦è´¨é‡â‰¤55kg, è“„ç”µæ± æ ‡ç§°ç”µå‹â‰¤48V, ç”µæœºé¢å®šåŠŸç‡â‰¤400W, æœ€é«˜è®¾è®¡è½¦é€Ÿâ‰¤25km/h', background: 'è§„èŒƒç”µåŠ¨è‡ªè¡Œè½¦å¸‚åœºï¼Œå‡å°‘è¶…æ ‡è½¦å¸¦æ¥çš„äº¤é€šå®‰å…¨éšæ‚£ã€‚' },
        { region: 'æ¬§æ´²', type: 'ç”µåŠ¨è‡ªè¡Œè½¦', name: 'EN 15194:2017', date: '2017', features: 'ç”µæœºæŒç»­é¢å®šåŠŸç‡â‰¤250W, é€Ÿåº¦è¾¾åˆ°25km/hæ—¶ç”µæœºåœæ­¢åŠ©åŠ›, å¿…é¡»æœ‰è„šè¸æ¿ã€‚ç¬¦åˆæ ‡å‡†çš„EPACç­‰åŒäºæ™®é€šè‡ªè¡Œè½¦ç®¡ç†ã€‚', background: 'ç»Ÿä¸€æ¬§ç›Ÿå¸‚åœºç”µåŠ¨åŠ©åŠ›è‡ªè¡Œè½¦çš„æ ‡å‡†ï¼Œä¿ƒè¿›è‡ªç”±è´¸æ˜“å’Œä¿éšœå®‰å…¨ã€‚' },
        { region: 'ç¾æ´²', type: 'ç”µåŠ¨è‡ªè¡Œè½¦', name: 'Consumer Product Safety Act (CPSA)', date: '2002', features: 'å°†ä½é€Ÿç”µåŠ¨è‡ªè¡Œè½¦å®šä¹‰ä¸ºæ¶ˆè´¹å“ã€‚ç”µæœºåŠŸç‡<750W, æœ€é«˜è½¦é€Ÿ<20mph (32km/h)ã€‚å„å·æ³•å¾‹å¯èƒ½ä¸åŒã€‚', background: 'è”é‚¦å±‚é¢ä¸ºç”µåŠ¨è‡ªè¡Œè½¦æä¾›åŸºæœ¬å®šä¹‰ï¼Œä½†å…·ä½“è·¯æƒç­‰ç”±å„å·è§„å®šã€‚' },
        { region: 'ä¸­å›½', type: 'ç”µåŠ¨æ‘©æ‰˜', name: 'GB/T 24158-2018ã€Šç”µåŠ¨æ‘©æ‰˜è½¦å’Œç”µåŠ¨è½»ä¾¿æ‘©æ‰˜è½¦å®‰å…¨è¦æ±‚ã€‹', date: '2019', features: 'æ ¹æ®æœ€é«˜æ—¶é€Ÿå’Œç”µæœºåŠŸç‡åˆ†ä¸ºè½»ä¾¿æ‘©æ‰˜å’Œæ‘©æ‰˜ã€‚éœ€ä¸Šç‰Œã€é©¾ç…§ã€ä¿é™©ã€‚ç”µæ± éœ€ç¬¦åˆGB/T 36972æ ‡å‡†ã€‚', background: 'å°†ç”µåŠ¨æ‘©æ‰˜çº³å…¥æœºåŠ¨è½¦ç®¡ç†ä½“ç³»ï¼Œä¿éšœé“è·¯å®‰å…¨å’Œäº§å“è´¨é‡ã€‚' },
        { region: 'æ¬§æ´²', type: 'è½»ä¾¿ç”µåŠ¨æ‘©æ‰˜', name: 'Regulation (EU) No 168/2013', date: '2013', features: 'Lç±»è½¦è¾†åˆ†ç±»æ³•ã€‚L1e-Bï¼ˆè½»ä¾¿æ‘©æ‰˜ï¼‰æœ€é«˜è½¦é€Ÿâ‰¤45km/h, åŠŸç‡â‰¤4kWã€‚è¦æ±‚æ›´ä¸¥æ ¼çš„æ•´è½¦è®¤è¯ï¼ˆWVTAï¼‰ã€‚', background: 'å»ºç«‹ç»Ÿä¸€çš„æ¬§ç›Ÿä¸¤è½®ã€ä¸‰è½®å’Œå››è½®è½¦å®¡æ‰¹å’Œå¸‚åœºç›‘ç£æ¡†æ¶ã€‚' },
        { region: 'ä¸œå—äºš', type: 'ç”µåŠ¨æ‘©æ‰˜', name: 'å„å›½æ ‡å‡†ä¸ä¸€ (å¦‚TIS 1829-2551 in Thailand)', date: 'Varies', features: 'é€šå¸¸å‚è€ƒå›½é™…æ ‡å‡†ï¼ˆå¦‚ECEï¼‰æˆ–æ—¥æœ¬æ ‡å‡†ï¼Œä½†æœ‰æœ¬åœ°åŒ–è°ƒæ•´ã€‚å¯¹ç”µæ± çƒ­å¸¦é€‚åº”æ€§æœ‰éšæ€§è¦æ±‚ã€‚', background: 'å„å›½ä¸ºæ¨åŠ¨ç”µåŠ¨åŒ–å’Œä¿éšœæ¶ˆè´¹è€…å®‰å…¨ï¼Œé€æ­¥å»ºç«‹è‡ªå·±çš„æ ‡å‡†ä½“ç³»ã€‚' }
    ];

    // --- å…¨å±€å˜é‡å’Œå›¾è¡¨å®ä¾‹ ---
    let customerTypeChart = null;
    let competitorTechChart = null;

    // --- åˆå§‹åŒ– ---
    const init = () => {
        setupTabs();
        populateFilters();
        renderAll();
        setupEventListeners();
        document.querySelector('.tab-button[data-tab="customers"]').click();
    };

    // --- é€‰é¡¹å¡é€»è¾‘ ---
    const setupTabs = () => {
        const tabContainer = document.getElementById('tabs');
        const tabContents = document.querySelectorAll('.tab-content');
        tabContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.tab-button');
            if (!button) return;
            
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            const tabId = button.dataset.tab;
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
        });
    };
    
    // --- ç­›é€‰å™¨å¡«å…… ---
    const populateFilters = () => {
        const customerRegions = [...new Set(customerData.map(c => c.region))];
        const customerTypes = [...new Set(customerData.map(c => c.type))];
        const competitorPartners = [...new Set(competitorData.flatMap(c => c.partners))];
        const competitorBatteryTypes = [...new Set(competitorData.map(c => c.batteryType))];
        const regulationRegions = [...new Set(regulationData.map(r => r.region))];
        const regulationTypes = [...new Set(regulationData.map(r => r.type))];

        populateSelect('customer-region-filter', customerRegions);
        populateSelect('customer-type-filter', customerTypes);
        populateSelect('competitor-partner-filter', competitorPartners);
        populateSelect('competitor-battery-filter', competitorBatteryTypes);
        populateSelect('regulation-region-filter', regulationRegions);
        populateSelect('regulation-type-filter', regulationTypes);
    };

    const populateSelect = (elementId, options) => {
        const select = document.getElementById(elementId);
        options.sort().forEach(option => {
            const opt = document.createElement('option');
            opt.value = option;
            opt.textContent = option;
            select.appendChild(opt);
        });
    };
    
    // --- æ¸²æŸ“é€»è¾‘ ---
    const renderAll = () => {
        renderCustomers();
        renderCompetitors();
        renderRegulations();
    };

    const renderCustomers = () => {
        const tbody = document.getElementById('customer-table-body');
        const search = document.getElementById('customer-search').value.toLowerCase();
        const region = document.getElementById('customer-region-filter').value;
        const type = document.getElementById('customer-type-filter').value;

        const filteredData = customerData.filter(c => 
            (c.name.toLowerCase().includes(search)) &&
            (region === '' || c.region === region) &&
            (type === '' || c.type === type)
        );

        if (filteredData.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center text-slate-500 py-10"><p class="text-lg">æ— åŒ¹é…ç»“æœ</p><p>è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶ã€‚</p></td></tr>`;
        } else {
            tbody.innerHTML = filteredData.map(c => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-medium">${c.name}</td>
                    <td class="p-3">${c.region}</td>
                    <td class="p-3">${c.type}</td>
                    <td class="p-3">${c.pack.voltage} / ${c.pack.capacity}</td>
                    <td class="p-3">${c.cell.chemistry} (${c.cell.type})</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline customer-details-btn" data-id="${c.id}">è¯¦æƒ…</button>
                    </td>
                </tr>
            `).join('');
        }
        updateCustomerChart(filteredData);
    };

    const renderCompetitors = () => {
        const tbody = document.getElementById('competitor-table-body');
        const search = document.getElementById('competitor-search').value.toLowerCase();
        const partner = document.getElementById('competitor-partner-filter').value;
        const battery = document.getElementById('competitor-battery-filter').value;

        const filteredData = competitorData.filter(c => 
            (c.name.toLowerCase().includes(search)) &&
            (partner === '' || c.partners.includes(partner)) &&
            (battery === '' || c.batteryType === battery)
        );
        
        if (filteredData.length === 0) {
           tbody.innerHTML = `<tr><td colspan="5" class="text-center text-slate-500 py-10"><p class="text-lg">æ— åŒ¹é…ç»“æœ</p><p>è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶ã€‚</p></td></tr>`;
        } else {
           tbody.innerHTML = filteredData.map(c => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-medium">${c.name}</td>
                    <td class="p-3">${c.partners.join(', ')}</td>
                    <td class="p-3">${c.batteryType}</td>
                    <td class="p-3 text-green-700">${c.opinion.convenience}</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline competitor-details-btn" data-id="${c.id}">è¯¦æƒ…</button>
                    </td>
                </tr>
            `).join('');
        }

        updateCompetitorChart(competitorData);
    };

    const renderRegulations = () => {
        const tbody = document.getElementById('regulation-table-body');
        const search = document.getElementById('regulation-search').value.toLowerCase();
        const region = document.getElementById('regulation-region-filter').value;
        const type = document.getElementById('regulation-type-filter').value;

        const filteredData = regulationData.filter(r => 
            (r.name.toLowerCase().includes(search)) &&
            (region === '' || r.region === region) &&
            (type === '' || r.type === type)
        );

        tbody.innerHTML = filteredData.map(r => `
            <tr class="border-b hover:bg-slate-50">
                <td class="p-3 font-medium">${r.region}</td>
                <td class="p-3">${r.type}</td>
                <td class="p-3 font-semibold text-slate-800">${r.name}</td>
                <td class="p-3">${r.date}</td>
                <td class="p-3 text-blue-700">${r.features}</td>
                <td class="p-3 text-slate-600">${r.background}</td>
            </tr>
        `).join('');
    };

    // --- å›¾è¡¨é€»è¾‘ ---
    const updateCustomerChart = (data) => {
        const ctx = document.getElementById('customer-type-chart').getContext('2d');
        const typeCounts = data.reduce((acc, curr) => {
            acc[curr.type] = (acc[curr.type] || 0) + 1;
            return acc;
        }, {});
        
        const labels = Object.keys(typeCounts);
        const counts = Object.values(typeCounts);

        if (customerTypeChart) {
            customerTypeChart.destroy();
        }
        
        customerTypeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    label: 'è½¦å‹æ•°é‡',
                    data: counts,
                    backgroundColor: ['#3b82f6', '#10b981', '#f97316', '#8b5cf6', '#ec4899'],
                    borderColor: '#fff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: false
                    }
                }
            }
        });
    };

    const updateCompetitorChart = (data) => {
        const ctx = document.getElementById('competitor-tech-chart').getContext('2d');
        const techCounts = data.reduce((acc, curr) => {
            const type = curr.batteryType;
            if (!acc[type]) acc[type] = 0;
            acc[type]++;
            return acc;
        }, {});

        const labels = Object.keys(techCounts);
        const counts = Object.values(techCounts);

        if (competitorTechChart) {
            competitorTechChart.destroy();
        }

        competitorTechChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ä¾›åº”å•†æ•°é‡',
                    data: counts,
                    backgroundColor: ['#2563eb', '#f59e0b', '#16a34a'],
                    borderColor: ['#1d4ed8', '#b45309', '#14532d'],
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                },
                scales: {
                    x: {
                        beginAtZero: true
                    }
                }
            }
        });
    };

    // --- äº‹ä»¶ç›‘å¬ ---
    const setupEventListeners = () => {
        document.getElementById('customer-search').addEventListener('input', renderCustomers);
        document.getElementById('customer-region-filter').addEventListener('change', renderCustomers);
        document.getElementById('customer-type-filter').addEventListener('change', renderCustomers);
        
        document.getElementById('competitor-search').addEventListener('input', renderCompetitors);
        document.getElementById('competitor-partner-filter').addEventListener('change', renderCompetitors);
        document.getElementById('competitor-battery-filter').addEventListener('change', renderCompetitors);

        document.getElementById('regulation-search').addEventListener('input', renderRegulations);
        document.getElementById('regulation-region-filter').addEventListener('change', renderRegulations);
        document.getElementById('regulation-type-filter').addEventListener('change', renderRegulations);

        document.getElementById('app').addEventListener('click', (e) => {
            const customerBtn = e.target.closest('.customer-details-btn');
            if (customerBtn) {
                const id = parseInt(customerBtn.dataset.id, 10);
                const data = customerData.find(c => c.id === id);
                if(data) showCustomerModal(data);
                return;
            }

            const competitorBtn = e.target.closest('.competitor-details-btn');
            if (competitorBtn) {
                const id = parseInt(competitorBtn.dataset.id, 10);
                const data = competitorData.find(c => c.id === id);
                if(data) showCompetitorModal(data);
                return;
            }
        });
        
        document.getElementById('modal-backdrop').addEventListener('click', closeModal);
        document.getElementById('modal-close').addEventListener('click', closeModal);
    };
    
    // --- å¼¹çª— Modal é€»è¾‘ ---
    const showCustomerModal = (data) => {
        const content = document.getElementById('modal-content');
        content.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">${data.name} - éœ€æ±‚è¯¦æƒ…</h2>
            <div class="space-y-4 text-sm">
                <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">ç”µæ± åŒ…ä¿¡æ¯</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li><b>ç”µå‹/ç”µé‡:</b> ${data.pack.voltage} / ${data.pack.capacity}</li>
                        <li><b>å°ºå¯¸:</b> ${data.pack.size}</li>
                        <li><b>å·¥ä½œæ¸©åº¦:</b> ${data.pack.temp}</li>
                        <li><b>å¾ªç¯å¯¿å‘½:</b> ${data.pack.life}</li>
                        <li><b>é˜²æŠ¤ç­‰çº§:</b> ${data.pack.ip}</li>
                    </ul>
                </div>
                 <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">å®¢æˆ·åé¦ˆ</h4>
                    <div class="space-y-2">
                       <p><b>ç—›ç‚¹:</b> <span class="text-red-600">${data.pack.painPoints}</span></p>
                       <p><b>ä¾¿åˆ©ç‚¹:</b> <span class="text-green-700">${data.pack.convenience}</span></p>
                       <p><b>åæ§½ç‚¹:</b> <span class="text-amber-600">${data.pack.complaints}</span></p>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">ç”µèŠ¯ä¿¡æ¯</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li><b>åŒ–å­¦ä½“ç³»:</b> ${data.cell.chemistry}</li>
                        <li><b>ç±»å‹:</b> ${data.cell.type}</li>
                        <li><b>ç”µå‹/ç”µé‡:</b> ${data.cell.voltage} / ${data.cell.capacity}</li>
                        <li><b>å°ºå¯¸:</b> ${data.cell.size}</li>
                        <li><b>å·¥ä½œæ¸©åº¦:</b> ${data.cell.temp}</li>
                        <li><b>å¾ªç¯å¯¿å‘½:</b> ${data.cell.life}</li>
                    </ul>
                </div>
            </div>
        `;
        openModal();
    };

    const showCompetitorModal = (data) => {
        const content = document.getElementById('modal-content');
        content.innerHTML = `
            <h2 class="text-2xl font-bold mb-4">${data.name} - å‹å•†åˆ†æ</h2>
             <div class="space-y-4 text-sm">
                <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">ç”µæ± åŒ…ä¿¡æ¯ (${data.batteryType})</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li><b>ç”µå‹/ç”µé‡:</b> ${data.pack.voltage} / ${data.pack.capacity}</li>
                        <li><b>å°ºå¯¸:</b> ${data.pack.size}</li>
                        <li><b>å·¥ä½œæ¸©åº¦:</b> ${data.pack.temp}</li>
                        <li><b>å¾ªç¯å¯¿å‘½:</b> ${data.pack.life}</li>
                        <li><b>é˜²æŠ¤ç­‰çº§:</b> ${data.pack.ip}</li>
                    </ul>
                </div>
                 <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">è§‚ç‚¹ä¿¡æ¯</h4>
                    <div class="space-y-2">
                       <p><b>ä¼˜åŠ¿/ä¾¿åˆ©ç‚¹:</b> <span class="text-green-700">${data.opinion.convenience}</span></p>
                       <p><b>åŠ£åŠ¿/ç—›ç‚¹:</b> <span class="text-red-600">${data.opinion.painPoints}</span></p>
                       <p><b>å¸‚åœºåé¦ˆ:</b> <span class="text-amber-600">${data.opinion.complaints}</span></p>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-slate-800 border-b pb-1 mb-2">ç”µèŠ¯ä¿¡æ¯</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600">
                        <li><b>åŒ–å­¦ä½“ç³»:</b> ${data.cell.chemistry}</li>
                        <li><b>ç±»å‹:</b> ${data.cell.type}</li>
                        <li><b>ç”µå‹/ç”µé‡:</b> ${data.cell.voltage} / ${data.cell.capacity}</li>
                        <li><b>å°ºå¯¸:</b> ${data.cell.size}</li>
                        <li><b>å·¥ä½œæ¸©åº¦:</b> ${data.cell.temp}</li>
                        <li><b>å¾ªç¯å¯¿å‘½:</b> ${data.cell.life}</li>
                    </ul>
                </div>
            </div>
        `;
        openModal();
    };
    
    const openModal = () => {
        document.getElementById('modal-backdrop').style.display = 'block';
        document.getElementById('modal').style.display = 'block';
    };
    
    const closeModal = () => {
        document.getElementById('modal-backdrop').style.display = 'none';
        document.getElementById('modal').style.display = 'none';
        document.getElementById('modal-content').innerHTML = '';
    };

    init();
});
</script>
</body>
</html>

